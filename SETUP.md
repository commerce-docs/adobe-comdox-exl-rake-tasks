# Setup Guide for Adobe Docs Rake Tasks

This guide explains how to set up and use the `adobe-docs-rake-tasks` gem in your documentation repositories.

## Quick Start

### 1. Add to Your Repository's Gemfile

```ruby
# In your repository's Gemfile
source 'https://rubygems.org'

gem 'jekyll'
gem 'rake'
# ... other gems

# Add the shared rake tasks gem
gem 'adobe-docs-rake-tasks', git: 'https://github.com/your-org/adobe-docs-rake-tasks.git'
```

### 2. Install Dependencies

```bash
bundle install
```

### 3. Verify Installation

```bash
bundle exec rake list_tasks
```

You should see all available tasks listed with descriptions.

## Repository Structure

The gem expects this standard Adobe docs structure:

```
your-repo/
├── help/
│   ├── _includes/          # Include files
│   │   ├── snippets.md
│   │   └── other-includes.md
│   ├── getting-started.md  # Main documentation files
│   ├── advanced-topics.md
│   └── troubleshooting.md
├── include-relationships.yml  # Generated by the gem
├── Gemfile
└── Rakefile
```

## Available Tasks

### Include Management

- `rake includes:maintain_relationships` - Discover and maintain include file relationships
- `rake includes:maintain_timestamps` - Update timestamps in main files  
- `rake includes:maintain_all` - Run both include tasks in sequence

### What's New Generation

- `rake whatsnew` - Generate What's New digest from GitHub activity
- `rake whatsnew_bp` - Generate Best Practices What's New digest

### Image Management

- `rake image_optim` - Optimize images in modified files
- `rake unused_images` - Find unused images
- `rake unused_includes` - Find unused include files



### Utility Tasks

- `rake render` - Render templated files
- `rake list_tasks` - Show available tasks with descriptions

## Usage Examples

### Daily Include Maintenance

```bash
# Run both include tasks
bundle exec rake includes:maintain_all
```

This will:
1. Discover all include relationships
2. Update timestamps in main files

### Image Optimization

```bash
# Optimize images in modified files
bundle exec rake image_optim

# Find unused images
bundle exec rake unused_images
```

### Include Auditing

```bash
# Find orphaned include files
bundle exec rake unused_includes
```

## Customization

### Override Default Behavior

You can override or extend tasks in your repository's `Rakefile`:

```ruby
# Load the shared tasks
require 'adobe-docs-rake-tasks'

# Add custom tasks or override existing ones
namespace :custom do
  desc 'My custom task'
  task :my_task do
    puts 'Running custom task...'
    # Your custom logic here
  end
end
```

### Environment Variables

Some tasks support environment variables:

```bash
# Specify a custom path for image optimization
path=help/assets bundle exec rake image_optim
```

## Troubleshooting

### Common Issues

1. **Tasks not found**: Ensure `bundle install` completed successfully
2. **Permission errors**: Check file permissions in your repository
3. **Path issues**: Ensure you're running from the repository root

### Debug Mode

For verbose output, you can set the `DEBUG` environment variable:

```bash
DEBUG=1 bundle exec rake includes:maintain_relationships
```

## Integration with CI/CD

### GitHub Actions Example

```yaml
name: Maintain Documentation
on:
  schedule:
    - cron: '0 2 * * *'  # Daily at 2 AM
  workflow_dispatch:

jobs:
  maintain-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.0'
          bundler-cache: true
      - run: bundle exec rake includes:maintain_all
      - run: bundle exec rake unused_images
      - run: bundle exec rake unused_includes
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          git diff --quiet && git diff --staged --quiet || git commit -m "Auto-maintain documentation"
          git push
```

## Best Practices

1. **Run regularly**: Schedule maintenance tasks to run daily or weekly
2. **Review changes**: Always review auto-generated changes before committing
3. **Backup first**: Ensure your repository is backed up before running maintenance
4. **Test locally**: Test tasks in a development branch before running in production
5. **Monitor output**: Check task output for warnings or errors

## Getting Help

- Use `rake list_tasks` to see all available tasks
- Check the main [README.md](README.md) for detailed documentation
- Open an issue on the gem repository for bugs or feature requests
- Contact the Adobe Documentation Team for support
